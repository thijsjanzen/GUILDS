<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walkthrough • GUILDS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Walkthrough">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GUILDS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Walkthrough.html">Walkthrough</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/thijsjanzen/GUILDS/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Walkthrough</h1>
                        <h4 data-toc-skip class="author">Thijs
Janzen</h4>
            
            <h4 data-toc-skip class="date">2016-09-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thijsjanzen/GUILDS/blob/master/vignettes/Walkthrough.Rmd" class="external-link"><code>vignettes/Walkthrough.Rmd</code></a></small>
      <div class="hidden name"><code>Walkthrough.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="guilds-vignette">Guilds Vignette<a class="anchor" aria-label="anchor" href="#guilds-vignette"></a>
</h2>
<p>Welcome to the vignette of GUILDS. GUILDS is an R package aimed at
providing the user with easy to use functions that help dealing with the
Unified Neutral Theory of Biodiversity and Biogeography. More
specifically, the package bundles together the sampling functions for
the Neutral Model including multiple guilds that differ in dispersal
ability (Janzen et al. 2015), and the Etienne sampling formula for the
standard neutral model. Furthermore, the package contains functions to
generate artificial datasets, and to calculate the expected
abundances.</p>
</div>
<div class="section level2">
<h2 id="the-standard-neutral-model">The standard neutral model<a class="anchor" aria-label="anchor" href="#the-standard-neutral-model"></a>
</h2>
<p>To generate data with the standard neutral model, we can make use of
the function <code>generate.ESF</code>, where ESF stands for the Etienne
Sampling Formula. generate.ESF makes use of the urn scheme described in
Etienne (2005), where the avid reader can also find more details on the
Etienne Sampling Formula. The ESF combines the universal biodiversity
number theta, and the universal dispersal number I. Typically, the
migration rate is a bit easier to interpret, so we will make use of that
first, then convert it to I, and then generate the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">*</span> <span class="op">(</span><span class="va">J</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="va">abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.ESF.html">generate.ESF</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">I</span>, <span class="va">J</span><span class="op">)</span></span>
<span><span class="va">abund</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1] 875 238 212 177 176 172 159 158 149 145 144 126 124 122 117 112 111 110</span></span>
<span><span class="co">##  [19] 110 109 108 108 106 101  99  95  93  92  86  80  80  79  78  77  76  75</span></span>
<span><span class="co">##  [37]  70  68  66  63  62  60  60  59  59  58  57  57  56  56  55  54  54  53</span></span>
<span><span class="co">##  [55]  52  51  51  50  48  47  46  46  45  44  44  43  43  43  43  42  42  41</span></span>
<span><span class="co">##  [73]  40  40  39  39  39  37  37  37  36  36  35  35  34  34  34  33  33  31</span></span>
<span><span class="co">##  [91]  31  30  30  30  30  30  29  29  28  28  28  27  26  26  26  26  26  26</span></span>
<span><span class="co">## [109]  26  25  25  24  24  24  24  24  24  23  22  22  22  21  21  21  21  20</span></span>
<span><span class="co">## [127]  20  20  20  20  20  20  20  19  19  19  19  18  18  18  18  17  17  17</span></span>
<span><span class="co">## [145]  17  17  17  16  16  16  16  16  16  15  15  15  15  15  14  14  14  13</span></span>
<span><span class="co">## [163]  13  13  12  12  12  12  12  12  12  11  11  11  11  11  11  10  10  10</span></span>
<span><span class="co">## [181]  10  10   9   9   9   9   9   9   9   9   8   8   8   8   8   8   8   8</span></span>
<span><span class="co">## [199]   8   8   8   8   8   7   7   7   7   7   7   7   7   7   7   7   7   6</span></span>
<span><span class="co">## [217]   6   6   6   6   6   6   6   5   5   5   5   5   5   5   5   5   5   5</span></span>
<span><span class="co">## [235]   5   5   5   5   5   4   4   4   4   4   4   4   4   4   4   4   4   4</span></span>
<span><span class="co">## [253]   4   4   4   4   4   4   3   3   3   3   3   3   3   3   3   3   3   3</span></span>
<span><span class="co">## [271]   3   3   3   3   3   3   3   3   3   3   2   2   2   2   2   2   2   2</span></span>
<span><span class="co">## [289]   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2</span></span>
<span><span class="co">## [307]   2   2   2   2   1   1   1   1   1   1   1   1   1   1   1   1   1   1</span></span>
<span><span class="co">## [325]   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1</span></span>
<span><span class="co">## [343]   1</span></span></code></pre>
<p>The package has now generated a nice species abundance distribution.
Using the function `<code>preston_plot</code> we can visualize our
abundance distribution</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/preston_plot.html">preston_plot</a></span><span class="op">(</span><span class="va">abund</span><span class="op">)</span></span></code></pre></div>
<p><img src="Walkthrough_files/figure-html/unnamed-chunk-1-1.png" width="576"></p>
<p>We can even do better, using the function <code>expected.SAD</code>
we can calculate the expected number of individuals per species.
Furthermore, we can easily add this to our plot:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abund.expect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expected.SAD.html">expected.SAD</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">m</span>, <span class="va">J</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/preston_plot.html">preston_plot</a></span><span class="op">(</span><span class="va">abund</span>, <span class="va">abund.expect</span><span class="op">)</span></span></code></pre></div>
<p><img src="Walkthrough_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>We can clearly see that the simulated abundance distribution closely
matches the expected distribution (the black line), although the
stochastic nature of the simulation has caused some small deviations.
Using the Etienne Sampling Formula we can now estimate theta and m,
using maximum likelihood. Because we already know the real values (those
are the values that we used to simulate the data), we can nicely
crosscheck whether the Etienne Sampling Formula yields good results. We
start the maximum likelihood at three different starting points, to
compare convergence.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.ESF.html">maxLikelihood.ESF</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">m</span><span class="op">)</span>, <span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">LL2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.ESF.html">maxLikelihood.ESF</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">LL3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.ESF.html">maxLikelihood.ESF</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">LL1</span><span class="op">$</span><span class="va">par</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 102.0395279   0.1159656</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL2</span><span class="op">$</span><span class="va">par</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 101.9890695   0.1150816</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL3</span><span class="op">$</span><span class="va">par</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 102.0662586   0.1158091</span></span></code></pre>
<p>Regardless of the starting point, we recover the same parameter
estimates that are close to the real values theta = 100 and m = 0.1
.</p>
</div>
<div class="section level2">
<h2 id="dispersal-guilds">Dispersal Guilds<a class="anchor" aria-label="anchor" href="#dispersal-guilds"></a>
</h2>
<p>The guilds model, as described in Janzen et al. (2015), asks a
slightly different question from the standard neutral model. How would
species abundances look if there would be two guilds of species, where
the guilds would only differ in dispersal ability? Imagine for instance
a forest, where some tree species disperse using wind-aided seed
dispersal, and other tree species disperse using animal-aided seed
dispersal. The model assumes that the two guilds share a local
community, and the metacommunity, and share the same speciation dynamics
(e.g. have the same theta). Dispersal is different however, and in
contrast to the standard neutral model, where we would infer migration
rates, here we asses the dispersal ability: the guilds model postulates
that migration (m) is the product of the dispersal ability of the
species (alpha) and the species’ frequency in the metacommunity (p).</p>
<div class="section level3">
<h3 id="conditioning-on-guild-size">Conditioning on Guild size<a class="anchor" aria-label="anchor" href="#conditioning-on-guild-size"></a>
</h3>
<p>In the paper, we show that in order for parameter estimation to work
reliably, we have to condition our sampling formula’s on guild size. The
package also contains sampling formula’s without guild size, in order
for the user to reproduce our train of thought, but here we will focus
solely on situations where we have conditioned our sampling formula’s on
guild size, and hence we assume that the user knows the number of
individuals per guild.</p>
<p>So, without verder ado, let’s simulate some data and then apply the
relevant sampling formula’s. We start by simulating data using the “D0”
model, which assumes no differences in dispersal ability between the
guilds (e.g. the guilds model then reduces to the standard neutral
model)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">666</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">alpha_x</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">J_x</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span><span class="va">J_y</span> <span class="op">&lt;-</span> <span class="va">J</span> <span class="op">-</span> <span class="va">J_x</span></span>
<span></span>
<span><span class="va">abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.Guilds.Cond.html">generate.Guilds.Cond</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span>, <span class="va">alpha_x</span>, <span class="va">J_x</span>, <span class="va">J_y</span><span class="op">)</span></span></code></pre></div>
<p>Again, we can calculate the expected distributions, and visualize our
distributions. This time however, a small part of the calculation of the
expected distribution can not be treated analytically, and has to be
done via the means of simulation, so a larger number of replicates means
a more accurate expected distribution. Here we will use a low number of
replicates for computational reasons.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abund.expected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expected.SAD.Guilds.Conditional.html">expected.SAD.Guilds.Conditional</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span>, <span class="va">alpha_x</span>,</span>
<span>                                                  <span class="va">J_x</span>, <span class="va">J_y</span>, n_replicates <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/preston_plot.html">preston_plot</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">guildX</span>, <span class="va">abund.expected</span><span class="op">$</span><span class="va">guildX</span>, main <span class="op">=</span> <span class="st">"Guild X"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/preston_plot.html">preston_plot</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">guildY</span>, <span class="va">abund.expected</span><span class="op">$</span><span class="va">guildY</span>, main <span class="op">=</span> <span class="st">"Guild Y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Walkthrough_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>Before, we set the size of Guild X to 8000 individuals, and the size
of Guild Y to 2000 individuals. From the Preston plots we notice that
indeed Guild X contains more species, but that apart from that, there
are not many striking differences (we assumed equal dispersal of
course!) Now that we have our data, we can apply the guilds’ sampling
formula, and see whether it can accruately infer parameter values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.Guilds.Conditional.html">maxLikelihood.Guilds.Conditional</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span><span class="op">)</span>, </span>
<span>                                       model <span class="op">=</span> <span class="st">"D0"</span>,</span>
<span>                                       sadx <span class="op">=</span> <span class="va">abund</span><span class="op">$</span><span class="va">guildX</span>, </span>
<span>                                       sady <span class="op">=</span> <span class="va">abund</span><span class="op">$</span><span class="va">guildY</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">LL</span><span class="op">$</span><span class="va">par</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 180.6348705   0.0995815</span></span></code></pre>
<p>We see that the maximum likelihood algorithm accurately infers the
value of alpha, and gets relatively close to inferring the right value
of theta. If we would want to infer the rate of migration, we could, in
this case, also apply the standard neutral model (after all, there were
no differences in dispersal, rendering the guilds construction
obsolete):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.ESF.html">maxLikelihood.ESF</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span><span class="op">)</span>,</span>
<span>                         abund <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">guildX</span>, <span class="va">abund</span><span class="op">$</span><span class="va">guildY</span><span class="op">)</span>, </span>
<span>                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">LL1</span><span class="op">$</span><span class="va">par</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 246.0613192   0.2132893</span></span></code></pre>
<p>Using the ESF, we find a slightly higher estimate for theta (but
notice that the mean of the two estimates becomes really close to the
value we put in), and we find a higher value for m.</p>
</div>
<div class="section level3">
<h3 id="guilds-model-with-differences-in-dispersal">Guilds model with differences in dispersal<a class="anchor" aria-label="anchor" href="#guilds-model-with-differences-in-dispersal"></a>
</h3>
<p>So, what happens if we assume differences in dispersal? Let’s, for
fun, assume that there are two guilds (guild X and Y), where guild X is
much bigger, but where species from guild X have a much lower dispersal
ability:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">666</span> <span class="op">+</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">alpha_x</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">alpha_y</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span>  <span class="fl">1000</span></span>
<span><span class="va">J_x</span> <span class="op">&lt;-</span> <span class="fl">800</span></span>
<span><span class="va">J_y</span> <span class="op">&lt;-</span> <span class="va">J</span> <span class="op">-</span> <span class="va">J_x</span></span>
<span></span>
<span><span class="va">abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.Guilds.Cond.html">generate.Guilds.Cond</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span>, <span class="va">alpha_y</span>, <span class="va">J_x</span>, <span class="va">J_y</span><span class="op">)</span></span></code></pre></div>
<p>This generates the following dataset:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abund.expected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expected.SAD.Guilds.Conditional.html">expected.SAD.Guilds.Conditional</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span>, <span class="va">alpha_y</span>,</span>
<span>                                                  <span class="va">J_x</span>, <span class="va">J_y</span>, n_replicates <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/preston_plot.html">preston_plot</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">guildX</span>, <span class="va">abund.expected</span><span class="op">$</span><span class="va">guildX</span>, main <span class="op">=</span> <span class="st">"Guild X"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/preston_plot.html">preston_plot</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">guildY</span>, <span class="va">abund.expected</span><span class="op">$</span><span class="va">guildY</span>, main <span class="op">=</span> <span class="st">"Guild Y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Walkthrough_files/figure-html/expected_SAD_cond-1.png" width="576"></p>
<p>Clearly, there are now strong differences in the community
distributions: the larger guild has a much broader distribution, with
much less singletons than the smaller guild. Again, we can use maximum
likelihood to infer the parameters from the data:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ML1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.Guilds.Conditional.html">maxLikelihood.Guilds.Conditional</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span>, <span class="va">alpha_y</span><span class="op">)</span>, </span>
<span>                                       model <span class="op">=</span> <span class="st">"D1"</span>,</span>
<span>                                       sadx <span class="op">=</span> <span class="va">abund</span><span class="op">$</span><span class="va">guildX</span>, sady <span class="op">=</span> <span class="va">abund</span><span class="op">$</span><span class="va">guildY</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Maximum likelihood estimation shows that we can accurately infer the
underlying parameters. Furthermore, we can test whether the model
assuming differences in dispersal between guilds better explains the
data, than the model without. We do this by also fitting the model
without differences to the data, and compare the estimated
likelihoods:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ML2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.Guilds.Conditional.html">maxLikelihood.Guilds.Conditional</a></span><span class="op">(</span>init_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">alpha_x</span><span class="op">)</span>, </span>
<span>                                       model <span class="op">=</span> <span class="st">"D0"</span>,</span>
<span>                                       sadx <span class="op">=</span> <span class="va">abund</span><span class="op">$</span><span class="va">guildX</span>, sady <span class="op">=</span> <span class="va">abund</span><span class="op">$</span><span class="va">guildY</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>To do an honest comparison, we have to correct for the extra
parameter (alpha_y) in the “D1” model, we do this by calculating the AIC
value:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AIC_D1</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">3</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">-</span><span class="va">ML1</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">AIC_D0</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">-</span><span class="va">ML2</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">AIC_D1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 153.4068</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AIC_D0</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 194.3186</span></span></code></pre>
<p>The AIC of the D1 model is lower, indicating a much better fit - as
expected.</p>
<p>This concludes the vignette. Go out there, find abundance data and
check whether the data has guild structure! If not, use the ESF, but if
you can come up with a potential guild structure, apply the conditional
guilds sampling formula! Don’t forget to apply both the model with, and
without differences in dispersal ability, in order to verify that the
guilds really differ in dispersal ability!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thijs Janzen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
